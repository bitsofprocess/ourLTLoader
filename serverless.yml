org: bitsofprocess
app: ourlt
service: ourLT
frameworkVersion: '3'
plugins:
  # - serverless-webpack
  - serverless-dynamodb-local
  # - serverless-dynamodb-client
  - serverless-offline

provider:
  name: aws
  stage: dev
  runtime: nodejs14.x
  environment:
      # tableName: ${self:custom.tableName}
      dynamoTableName: ${self:custom.dynamoTableName}
  httpApi:
    cors: true
  iam:
    role:
      statements:
  #       - Effect: Allow
  #         Action:
  #           - dynamodb:Query
  #           - dynamodb:Scan
  #           - dynamodb:GetItem
  #           - dynamodb:PutItem
  #           - dynamodb:UpdateItem
  #           - dynamodb:DeleteItem
          # Resource: "arn:aws:dynamodb:${aws:region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"
    # iamRoleStatements:
        - Effect: Allow
          Action:
              - dynamodb:*
              - s3:*
              - ses:*
          Resource: '*'

custom:
  currentStage: ${opt:stage, self:provider.stage}
  dynamoTableName: ourLT-${self:custom.currentStage}

package:
    individually: true


functions:
  simple:
    handler: SLStest.simple
    events:
      - httpApi:
          path: /
          method: post
          cors: true
  # postOurLT:
  #   handler: post.postOurLT
  #   events:
  #     - httpApi:
  #         path: /
  #         method: get, post
  #         cors: true 

resources:
  Resources:
    ourLTProd:
      Type: 'AWS::DynamoDB::Table'
      Properties:
        TableName: ${self:custom.dynamoTableName}
        AttributeDefinitions:
          -
            AttributeName: team_id
            AttributeType: S
        KeySchema:
          -
            AttributeName: team_id
            KeyType: HASH
        BillingMode: PAY_PER_REQUEST

# custom:
#  webpack:
#   webpackConfig: 'webpack.config.js' # Name of webpack configuration file
#   includeModules: false # Node modules configuration for packaging
#   packager: 'npm' # Packager that will be used to package your external modules

  # tableName: x
  # dynamodb:
  #   stages:
  #     - dev   
  #   start:
  #     port: 8000
  #     inMemory: true
  #     migrate: true
  #     seed: true
  #   migration: 
  #     dir: offline/migrations

  #   seed:
  #     domain:
  #       sources:
  #         - table: ourLT-prod


